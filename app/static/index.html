<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyWatch - Smart Camera Capture System</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üå§Ô∏è SkyWatch</h1>
            <p class="subtitle">Smart Camera Capture System</p>
        </header>

        <nav class="tabs">
            <button class="tab active" data-tab="live">Live View</button>
            <button class="tab" data-tab="timelapse">Timelapse</button>
            <button class="tab" data-tab="solargraph">Solargraph</button>
            <button class="tab" data-tab="lunar">Lunar</button>
            <button class="tab" data-tab="motion">Motion</button>
            <button class="tab" data-tab="status">Status</button>
            <button class="tab" data-tab="settings">‚öôÔ∏è Settings</button>
        </nav>

        <main>
            <!-- Live View Tab -->
            <div id="live" class="tab-content active">
                <div class="video-container">
                    <div class="placeholder" id="live-placeholder">Loading live stream...</div>
                    <img id="live-stream" src="/api/stream" alt="Live Camera Feed" style="display:none;">
                </div>
                <div class="controls">
                    <button id="snapshot-btn">üì∏ Take Snapshot</button>
                </div>
            </div>

            <!-- Timelapse Tab -->
            <div id="timelapse" class="tab-content">
                <div class="controls">
                    <label>Date:</label>
                    <select id="timelapse-date">
                        <option value="">Loading...</option>
                    </select>
                    <button id="download-timelapse">‚¨áÔ∏è Download MP4</button>
                </div>
                <div class="video-container">
                    <video id="timelapse-player" controls playsinline>
                        <source src="" type="video/mp4">
                        Your browser doesn't support video playback.
                    </video>
                    <div class="placeholder" id="timelapse-placeholder">
                        Select a date to view timelapse
                    </div>
                </div>
                <div class="info">
                    <p id="timelapse-info">Select a date to view timelapse</p>
                    <p id="download-status" style="display:none; margin-top:10px;"></p>
                </div>
            </div>
                    </div>
                </div>
                <div class="info">
                    <p id="timelapse-info">Frame count: -</p>
                </div>
            </div>

            <!-- Solargraph Tab -->
            <div id="solargraph" class="tab-content">
                <div class="composite-container">
                    <img id="solargraph-composite" src="/api/solargraph/composite" alt="Solargraph Composite">
                    <div class="placeholder" id="solargraph-placeholder">
                        Solargraph composite will appear here once sun is detected
                    </div>
                </div>
                <div class="controls">
                    <button id="refresh-solargraph">üîÑ Refresh</button>
                    <button id="clear-solargraph" class="btn-danger">üóëÔ∏è Clear Composite</button>
                </div>
                <div class="info">
                    <p>The solargraph shows the sun's path across the sky. Each bright spot represents a captured sun position.</p>
                </div>
            </div>

            <!-- Lunar Tab -->
            <div id="lunar" class="tab-content">
                <div class="composite-container">
                    <img id="lunar-composite" src="/api/lunar/composite" alt="Lunar Composite">
                    <div class="placeholder" id="lunar-placeholder">
                        Lunar composite will appear here once moon is detected
                    </div>
                </div>
                <div class="controls">
                    <button id="refresh-lunar">üîÑ Refresh</button>
                    <button id="clear-lunar" class="btn-danger">üóëÔ∏è Clear Composite</button>
                </div>
                <div class="info">
                    <p>The lunar composite shows the moon's path across the night sky.</p>
                </div>
            </div>

            <!-- Motion Tab -->
            <div id="motion" class="tab-content">
                <div class="controls">
                    <button id="refresh-motion">üîÑ Refresh Events</button>
                </div>
                <div id="motion-events" class="motion-grid">
                    <p class="placeholder">Loading motion events...</p>
                </div>
            </div>

            <!-- Status Tab -->
            <div id="status" class="tab-content">
                <div class="controls">
                    <button id="refresh-status">üîÑ Refresh</button>
                </div>
                <div id="status-info" class="status-grid">
                    <p class="placeholder">Loading status...</p>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <div class="settings-container">
                    <h2>‚öôÔ∏è System Settings</h2>
                    <div class="settings-notice">
                        <p>‚ö†Ô∏è Changes require a restart to take effect</p>
                    </div>
                    
                    <form id="settings-form">
                        <!-- Camera Settings -->
                        <fieldset>
                            <legend>üìπ Camera Settings</legend>
                            <div class="form-group">
                                <label for="camera-url">RTSP URL:</label>
                                <input type="text" id="camera-url" name="camera.rtsp_url" placeholder="rtsp://user:pass@ip:port/stream" required>
                            </div>
                            <div class="form-group">
                                <label for="camera-reconnect">Reconnect Interval (seconds):</label>
                                <input type="number" id="camera-reconnect" name="camera.reconnect_interval" min="1" max="60" value="5">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="camera-width">Frame Width:</label>
                                    <input type="number" id="camera-width" name="camera.frame_width" min="640" value="1920">
                                </div>
                                <div class="form-group">
                                    <label for="camera-height">Frame Height:</label>
                                    <input type="number" id="camera-height" name="camera.frame_height" min="480" value="1080">
                                </div>
                            </div>
                        </fieldset>

                        <!-- Storage Settings -->
                        <fieldset>
                            <legend>üíæ Storage Settings</legend>
                            <div class="form-group">
                                <label for="storage-path">Base Path:</label>
                                <input type="text" id="storage-path" name="storage.base_path" required>
                            </div>
                            <div class="form-group">
                                <label for="storage-retention">Data Retention (days):</label>
                                <input type="number" id="storage-retention" name="storage.retention_days" min="1" max="365" value="30">
                                <small>How many days to keep captured data</small>
                            </div>
                        </fieldset>

                        <!-- Timelapse Settings -->
                        <fieldset>
                            <legend>‚è±Ô∏è Timelapse Settings</legend>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="timelapse-enabled" name="timelapse.enabled" checked>
                                    Enable Timelapse
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="timelapse-interval">Capture Interval (seconds):</label>
                                <input type="number" id="timelapse-interval" name="timelapse.interval" min="1" max="3600" value="60">
                                <small>Time between each timelapse frame</small>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="timelapse-quality">JPEG Quality (1-100):</label>
                                    <input type="number" id="timelapse-quality" name="timelapse.quality" min="1" max="100" value="90">
                                </div>
                                <div class="form-group">
                                    <label for="timelapse-fps">Video FPS:</label>
                                    <input type="number" id="timelapse-fps" name="timelapse.video_fps" min="1" max="60" value="24">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="timelapse-daily" name="timelapse.daily_video" checked>
                                    Create daily video compilation
                                </label>
                            </div>
                        </fieldset>

                        <!-- Motion Detection Settings -->
                        <fieldset>
                            <legend>üé¨ Motion Detection Settings</legend>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="motion-enabled" name="motion.enabled" checked>
                                    Enable Motion Detection
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="motion-sensitivity">Sensitivity (0-100):</label>
                                <input type="range" id="motion-sensitivity" name="motion.sensitivity" min="0" max="100" value="25">
                                <span id="motion-sensitivity-value">25</span>
                                <small>Lower = more sensitive</small>
                            </div>
                            <div class="form-group">
                                <label for="motion-min-area">Minimum Area (pixels):</label>
                                <input type="number" id="motion-min-area" name="motion.min_area" min="100" max="10000" value="500">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="motion-burst-count">Burst Count:</label>
                                    <input type="number" id="motion-burst-count" name="motion.burst_count" min="1" max="100" value="10">
                                </div>
                                <div class="form-group">
                                    <label for="motion-burst-fps">Burst FPS:</label>
                                    <input type="number" id="motion-burst-fps" name="motion.burst_fps" min="1" max="30" value="10">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="motion-cooldown">Cooldown (seconds):</label>
                                <input type="number" id="motion-cooldown" name="motion.cooldown" min="0" max="60" value="5">
                            </div>
                        </fieldset>

                        <!-- Solargraph Settings -->
                        <fieldset>
                            <legend>‚òÄÔ∏è Solargraph Settings</legend>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="solargraph-enabled" name="solargraph.enabled" checked>
                                    Enable Solargraph
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="solargraph-interval">Detection Interval (seconds):</label>
                                <input type="number" id="solargraph-interval" name="solargraph.detection_interval" min="10" max="300" value="30">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="solargraph-latitude">Latitude:</label>
                                    <input type="number" id="solargraph-latitude" name="solargraph.latitude" min="-90" max="90" step="0.0001" value="0">
                                </div>
                                <div class="form-group">
                                    <label for="solargraph-longitude">Longitude:</label>
                                    <input type="number" id="solargraph-longitude" name="solargraph.longitude" min="-180" max="180" step="0.0001" value="0">
                                </div>
                            </div>
                        </fieldset>

                        <!-- Lunar Settings -->
                        <fieldset>
                            <legend>üåô Lunar Tracking Settings</legend>
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="lunar-enabled" name="lunar.enabled" checked>
                                    Enable Lunar Tracking
                                </label>
                            </div>
                            <div class="form-group">
                                <label for="lunar-interval">Detection Interval (seconds):</label>
                                <input type="number" id="lunar-interval" name="lunar.detection_interval" min="10" max="300" value="60">
                            </div>
                        </fieldset>

                        <div class="form-actions">
                            <button type="button" id="save-settings" class="btn-primary">üíæ Save Settings</button>
                            <button type="button" id="reset-settings" class="btn-secondary">üîÑ Reset to Current</button>
                        </div>
                    </form>

                    <div id="settings-message" class="settings-message" style="display:none;"></div>
                </div>
            </div>
        </main>

        <footer>
            <p>SkyWatch v1.0 | <a href="https://github.com/srikanth8286/skywatch" target="_blank">GitHub</a></p>
        </footer>
    </div>

    <script src="/script.js"></script>
</body>
</html>
